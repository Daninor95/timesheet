<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Timesheet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2D5F8D;
            --primary-dark: #1E4A6F;
            --accent: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #1E293B;
            --text-light: #64748B;
            --border: #E2E8F0;
            --success: #10B981;
            --danger: #EF4444;
            --shadow: rgba(15, 23, 42, 0.08);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 1rem;
            box-shadow: 0 2px 8px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .header p {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px var(--shadow);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.375rem;
            color: var(--text);
        }

        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
            -webkit-appearance: none;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 95, 141, 0.1);
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
            background: var(--primary-dark);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--text-light);
            color: white;
        }

        .btn-export {
            background: var(--accent);
            color: white;
            margin-top: 0.5rem;
        }

        .btn-export:active {
            transform: scale(0.98);
            background: #D97706;
        }

        .entry-item {
            background: var(--bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--primary);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .entry-employee {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text);
        }

        .entry-date {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .entry-mission {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .entry-time {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }

        .time-range {
            color: var(--text-light);
        }

        .hours-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.25rem;
            line-height: 1;
        }

        .summary-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .summary-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .summary-hours {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .summary-period {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        .filter-section {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1.5px solid var(--border);
            background: white;
            border-radius: 8px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .alert-info {
            background: #DBEAFE;
            color: #1E40AF;
            border: 1px solid #BFDBFE;
        }

        .alert-warning {
            background: #FEF3C7;
            color: #92400E;
            border: 1px solid #FDE68A;
        }

        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .login-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .manager-view {
            background: #FEF3C7;
            color: #92400E;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .summary-grid {
            display: grid;
            gap: 0.75rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg);
            border-radius: 8px;
        }

        .summary-name {
            font-weight: 600;
            color: var(--text);
        }

        .summary-hours-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .card {
                padding: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1 class="login-title">‚è±Ô∏è Timesheet</h1>
            <p class="login-subtitle">Enter your name to continue</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="userName">Your Name</label>
                    <input type="text" id="userName" required placeholder="Enter your full name" autocomplete="name">
                </div>
                
                <button type="submit" class="btn btn-primary">
                    Continue
                </button>
            </form>

            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <button class="btn btn-secondary" id="managerLoginBtn">
                    üîë Manager Login
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="header">
            <h1>‚è±Ô∏è Timesheet</h1>
            <p id="userGreeting"></p>
        </div>

        <div class="container">
            <div id="managerAlert" class="manager-view" style="display: none;">
                üëî <strong>Manager View:</strong> You can see all employees' data
            </div>

            <div class="alert alert-warning" id="storageWarning">
                üì± <strong>Note:</strong> Data is stored on this device only. To share data across all employees, you'll need to set up a shared solution.
            </div>

            <!-- Summary Card -->
            <div class="summary-card" id="summaryCard">
                <div class="summary-label">Total Hours</div>
                <div class="summary-hours" id="totalHours">0.00</div>
                <div class="summary-period" id="summaryPeriod">All time</div>
            </div>

            <!-- Entry Form -->
            <div class="card">
                <h2 class="card-title">Add Time Entry</h2>
                <form id="entryForm">
                    <div class="form-group">
                        <label for="date">Date</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label for="mission">Mission / Task</label>
                        <input type="text" id="mission" required placeholder="e.g., Project Alpha">
                    </div>

                    <div class="form-group">
                        <label>Work Hours</label>
                        <div class="time-inputs">
                            <div>
                                <input type="time" id="startTime" required>
                                <small style="color: var(--text-light); font-size: 0.75rem;">Start Time</small>
                            </div>
                            <div>
                                <input type="time" id="endTime" required>
                                <small style="color: var(--text-light); font-size: 0.75rem;">End Time</small>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        ‚ûï Add Entry
                    </button>
                </form>
            </div>

            <!-- Manager Summary (only visible to manager) -->
            <div class="card" id="managerSummary" style="display: none;">
                <h2 class="card-title">Employee Summary</h2>
                <div class="filter-section">
                    <button class="filter-btn active" data-period="all">All Time</button>
                    <button class="filter-btn" data-period="month">This Month</button>
                    <button class="filter-btn" data-period="week">This Week</button>
                </div>
                <div class="summary-grid" id="employeeSummaryGrid"></div>
            </div>

            <!-- Entries List -->
            <div class="card">
                <h2 class="card-title" id="entriesTitle">My Time Entries</h2>
                <div id="entriesList">
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p>No entries yet. Add your first time entry above.</p>
                    </div>
                </div>
                <button class="btn btn-export" id="exportBtn" style="display: none;">
                    üìä Export to CSV
                </button>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-secondary" id="logoutBtn" style="max-width: 200px; margin: 0 auto;">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentUser = null;
        let isManager = false;
        let allEntries = [];
        let currentFilter = 'all';

        const MANAGER_PASSWORD = 'manager123'; // Change this to your preferred password
        const STORAGE_KEY = 'timesheet_data';

        // Load all entries from localStorage
        function loadEntries() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                allEntries = data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('Error loading entries:', error);
                allEntries = [];
            }
        }

        // Save all entries to localStorage
        function saveEntries() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(allEntries));
                return true;
            } catch (error) {
                console.error('Error saving entries:', error);
                alert('Failed to save entry. Storage may be full.');
                return false;
            }
        }

        // Calculate hours between two times
        function calculateHours(startTime, endTime) {
            const [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);
            
            const startMinutes = startHour * 60 + startMin;
            const endMinutes = endHour * 60 + endMin;
            
            let diffMinutes = endMinutes - startMinutes;
            if (diffMinutes < 0) {
                diffMinutes += 24 * 60;
            }
            
            return (diffMinutes / 60).toFixed(2);
        }

        // Format date for display
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Filter entries by period
        function filterEntriesByPeriod(entries, period) {
            if (period === 'all') return entries;
            
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            
            return entries.filter(entry => {
                const entryDate = new Date(entry.date + 'T00:00:00');
                if (period === 'week') {
                    return entryDate >= startOfWeek;
                } else if (period === 'month') {
                    return entryDate >= startOfMonth;
                }
                return true;
            });
        }

        // Render the entire app
        function renderApp() {
            if (!currentUser) return;

            // Filter entries based on user
            const userEntries = isManager ? allEntries : allEntries.filter(e => e.employeeName === currentUser);
            
            // Update summary card
            const filteredEntries = filterEntriesByPeriod(userEntries, currentFilter);
            const totalHours = filteredEntries.reduce((sum, e) => sum + parseFloat(e.hours), 0);
            document.getElementById('totalHours').textContent = totalHours.toFixed(2);
            
            const periodText = currentFilter === 'all' ? 'All time' : 
                              currentFilter === 'month' ? 'This month' : 'This week';
            document.getElementById('summaryPeriod').textContent = periodText;

            // Render entries list
            renderEntriesList(userEntries);

            // Render manager summary if manager
            if (isManager) {
                renderManagerSummary();
            }
        }

        // Render entries list
        function renderEntriesList(entries) {
            const entriesList = document.getElementById('entriesList');
            const exportBtn = document.getElementById('exportBtn');
            
            if (entries.length === 0) {
                entriesList.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p>No entries yet. Add your first time entry above.</p>
                    </div>
                `;
                exportBtn.style.display = 'none';
                return;
            }

            exportBtn.style.display = 'block';
            
            // Sort by date (newest first)
            const sortedEntries = [...entries].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            entriesList.innerHTML = sortedEntries.map(entry => `
                <div class="entry-item">
                    <div class="entry-header">
                        <div>
                            ${isManager ? `<div class="entry-employee">${entry.employeeName}</div>` : ''}
                            <div class="entry-date">${formatDate(entry.date)}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteEntry(${entry.timestamp})">√ó</button>
                    </div>
                    <div class="entry-mission">${entry.mission}</div>
                    <div class="entry-time">
                        <span class="time-range">${entry.startTime} - ${entry.endTime}</span>
                        <span class="hours-badge">${entry.hours}h</span>
                    </div>
                </div>
            `).join('');
        }

        // Render manager summary
        function renderManagerSummary() {
            if (!isManager) return;

            const summaryCard = document.getElementById('managerSummary');
            const summaryGrid = document.getElementById('employeeSummaryGrid');
            
            summaryCard.style.display = 'block';
            
            const filteredEntries = filterEntriesByPeriod(allEntries, currentFilter);
            
            // Calculate total hours per employee
            const employeeHours = {};
            filteredEntries.forEach(entry => {
                if (!employeeHours[entry.employeeName]) {
                    employeeHours[entry.employeeName] = 0;
                }
                employeeHours[entry.employeeName] += parseFloat(entry.hours);
            });
            
            if (Object.keys(employeeHours).length === 0) {
                summaryGrid.innerHTML = '<div class="empty-state"><p>No entries for selected period</p></div>';
                return;
            }
            
            summaryGrid.innerHTML = Object.entries(employeeHours)
                .sort((a, b) => a[0].localeCompare(b[0]))
                .map(([name, hours]) => `
                    <div class="summary-item">
                        <span class="summary-name">${name}</span>
                        <span class="summary-hours-text">${hours.toFixed(2)}h</span>
                    </div>
                `).join('');
        }

        // Show main app
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userGreeting').textContent = 
                isManager ? 'Manager View - All Employees' : `Hello, ${currentUser}`;
            
            if (isManager) {
                document.getElementById('managerAlert').style.display = 'flex';
                document.getElementById('entriesTitle').textContent = 'All Time Entries';
                document.getElementById('storageWarning').style.display = 'none';
            }
            
            loadEntries();
            renderApp();
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const userName = document.getElementById('userName').value.trim();
            
            if (userName) {
                currentUser = userName;
                isManager = false;
                showMainApp();
            }
        });

        // Manager login
        document.getElementById('managerLoginBtn').addEventListener('click', function() {
            const password = prompt('Enter manager password:');
            if (password === MANAGER_PASSWORD) {
                currentUser = 'Manager';
                isManager = true;
                showMainApp();
            } else if (password !== null) {
                alert('Incorrect password');
            }
        });

        // Add entry
        document.getElementById('entryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const mission = document.getElementById('mission').value.trim();
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            const hours = calculateHours(startTime, endTime);
            
            const entry = {
                employeeName: currentUser,
                date,
                mission,
                startTime,
                endTime,
                hours,
                timestamp: Date.now()
            };
            
            allEntries.push(entry);
            
            if (saveEntries()) {
                this.reset();
                document.getElementById('date').valueAsDate = new Date();
                renderApp();
            } else {
                // Remove the entry if save failed
                allEntries.pop();
            }
        });

        // Delete entry
        window.deleteEntry = function(timestamp) {
            const entry = allEntries.find(e => e.timestamp === timestamp);
            
            // Check if user can delete (own entry or manager)
            if (!isManager && entry.employeeName !== currentUser) {
                alert('You can only delete your own entries');
                return;
            }
            
            if (confirm('Delete this entry?')) {
                allEntries = allEntries.filter(e => e.timestamp !== timestamp);
                saveEntries();
                renderApp();
            }
        };

        // Filter buttons
        document.querySelectorAll('.filter-btn[data-period]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn[data-period]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.period;
                renderApp();
            });
        });

        // Export to CSV
        document.getElementById('exportBtn').addEventListener('click', function() {
            const entriesToExport = isManager ? allEntries : allEntries.filter(e => e.employeeName === currentUser);
            const sortedEntries = [...entriesToExport].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let csv = 'Employee Name,Date,Mission/Task,Start Time,End Time,Hours Worked\n';
            sortedEntries.forEach(entry => {
                csv += `"${entry.employeeName}","${entry.date}","${entry.mission}","${entry.startTime}","${entry.endTime}","${entry.hours}"\n`;
            });
            
            // Add summary
            const filteredEntries = filterEntriesByPeriod(entriesToExport, currentFilter);
            
            if (isManager) {
                const employeeHours = {};
                filteredEntries.forEach(entry => {
                    if (!employeeHours[entry.employeeName]) {
                        employeeHours[entry.employeeName] = 0;
                    }
                    employeeHours[entry.employeeName] += parseFloat(entry.hours);
                });
                
                csv += '\nSUMMARY BY EMPLOYEE\n';
                csv += 'Employee Name,Total Hours\n';
                Object.entries(employeeHours)
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .forEach(([name, hours]) => {
                        csv += `"${name}","${hours.toFixed(2)}"\n`;
                    });
            } else {
                const totalHours = filteredEntries.reduce((sum, e) => sum + parseFloat(e.hours), 0);
                csv += '\nSUMMARY\n';
                csv += `Total Hours,"${totalHours.toFixed(2)}"\n`;
            }
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const filename = isManager ? 
                `all_employees_timesheet_${new Date().toISOString().split('T')[0]}.csv` :
                `${currentUser.replace(/\s+/g, '_')}_timesheet_${new Date().toISOString().split('T')[0]}.csv`;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            isManager = false;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('loginForm').reset();
        });

        // Initialize
        document.getElementById('date').valueAsDate = new Date();
    </script>
</body>
</html>
